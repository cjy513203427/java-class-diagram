# Java类图导航功能

## 功能概述

本扩展现在支持通过Language Server实现精确的代码导航功能。在webview中点击类图中的元素可以直接跳转到对应的代码位置。

## 主要功能

### 1. 类名导航
- **功能**: 点击类图中的类名可以直接跳转到该类的定义位置
- **实现**: 使用Java Language Server的符号搜索功能精确定位类的位置
- **特点**: 
  - 支持工作区内的所有Java类
  - 自动高亮显示目标类名
  - 支持接口、枚举和抽象类

### 2. 方法导航
- **功能**: 点击类图中的方法名可以直接跳转到该方法的定义位置
- **实现**: 通过Language Server解析文档符号，精确定位方法位置
- **特点**:
  - 支持构造函数、实例方法和静态方法
  - 自动高亮显示目标方法
  - 支持重载方法的识别

### 3. 字段导航
- **功能**: 点击类图中的字段名可以直接跳转到该字段的定义位置
- **实现**: 通过Language Server解析文档符号，精确定位字段位置
- **特点**:
  - 支持私有、保护和公共字段
  - 支持静态字段和常量
  - 自动高亮显示目标字段

## 技术实现

### Language Server集成
- 使用VSCode的Java Language Server (Red Hat Java扩展)
- 通过`vscode.executeWorkspaceSymbolProvider`搜索符号
- 通过`vscode.executeDocumentSymbolProvider`解析文档结构

### 精确定位算法
1. **类定位**: 使用符号名称精确匹配
2. **方法定位**: 在类符号的子符号中查找方法
3. **字段定位**: 在类符号的子符号中查找字段

### 智能点击检测
- 分析PlantUML代码结构
- 根据点击位置的Y坐标推断点击目标
- 支持多类图中的精确定位

## 使用方法

1. **生成类图**: 使用命令面板中的"Generate Class Diagram"命令
2. **点击导航**: 在生成的类图中点击任意类名、方法名或字段名
3. **自动跳转**: 系统会自动打开对应的Java文件并跳转到精确位置

## 错误处理

### 多级回退机制
1. **首选**: Language Server精确定位
2. **备选**: 文件路径 + 正则表达式搜索
3. **最后**: 工作区符号搜索

### 用户友好的错误提示
- 中文错误消息
- 详细的错误信息
- 自动重试机制

## 性能优化

- **异步处理**: 所有导航操作都是异步的，不会阻塞UI
- **缓存机制**: Language Server客户端复用，减少初始化开销
- **智能高亮**: 临时高亮显示目标位置，2秒后自动清除

## 兼容性

- **VSCode版本**: 1.60.0+
- **Java扩展**: 需要安装Red Hat Java扩展包
- **Java版本**: 支持Java 8+
- **操作系统**: Windows, macOS, Linux

## 测试用例

项目中包含了测试类用于验证导航功能:
- `test-classes/NavigationTest.java`: 基本导航功能测试
- `test-classes/BaseClass.java`: 抽象类导航测试
- `test-classes/DerivedClass.java`: 继承关系导航测试

## 未来改进

1. **更精确的点击检测**: 基于SVG元素的精确点击检测
2. **跨项目导航**: 支持依赖库中的类导航
3. **快捷键支持**: 添加键盘快捷键进行导航
4. **导航历史**: 支持前进/后退导航历史
